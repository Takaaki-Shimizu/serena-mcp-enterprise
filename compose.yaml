services:
  serena:
    image: serena-enterprise:latest
    build:
      context: ./
      dockerfile: Dockerfile
    networks:
      - serena-isolated  # éš”é›¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶š
    volumes:
      # ğŸ“ PROJECTç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã‚’ãƒã‚¦ãƒ³ãƒˆ
      - ${PROJECT}:/workspace:rw  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆ
      - ${PROJECT}/.serena:/home/serena/.serena:rw  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®Serenaè¨­å®šæ°¸ç¶šåŒ–
    environment:
      - SERENA_DOCKER=1 # ã“ã®ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚Šã€Serena ã¯ Docker ç’°å¢ƒã§ã®å®Ÿè¡Œã‚’èªè­˜ã—ã€é©åˆ‡ãªè¨­å®šã¨ãƒ‘ã‚¹è§£æ±ºã‚’è¡Œã†
    # ENTRYPOINTã‚’ç„¡åŠ¹åŒ–
    entrypoint: []
    # Serenaã‚’ç›´æ¥å®Ÿè¡Œ
    command: ["serena-mcp-server", "--transport", "stdio"]
    tty: true # TTYã‚’æœ‰åŠ¹ã«ã—ã¦ã€å¯¾è©±çš„ãªæ“ä½œã‚’å¯èƒ½ã«ã™ã‚‹
    stdin_open: true  # æ¨™æº–å…¥åŠ›ã‚’é–‹ã„ãŸã¾ã¾ã«ã™ã‚‹ï¼ˆstdioãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰
    security_opt:
      - no-new-privileges:true  # ç‰¹æ¨©æ˜‡æ ¼ã‚’é˜²æ­¢ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼‰
    cap_drop:
      - ALL  # ã™ã¹ã¦ã®Linux capabilityã‚’å‰Šé™¤ï¼ˆæœ€å°æ¨©é™ã®åŸå‰‡ï¼‰

networks:
  serena-isolated:
    driver: bridge  # ã‚³ãƒ³ãƒ†ãƒŠé–“ã¯é€šä¿¡å¯èƒ½
    internal: true  # å¤–éƒ¨é€šä¿¡å®Œå…¨é®æ–­ï¼ˆtrueã§é®æ–­ã€falseã§è¨±å¯ï¼‰
